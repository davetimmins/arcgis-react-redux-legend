!function(e,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n(require("esri-loader"),require("react"),require("react-redux"));else if("function"==typeof define&&define.amd)define(["esri-loader","react","react-redux"],n);else{var a="object"==typeof exports?n(require("esri-loader"),require("react"),require("react-redux")):n(e["esri-loader"],e.react,e["react-redux"]);for(var t in a)("object"==typeof exports?exports:e)[t]=a[t]}}(this,function(e,n,a){return function(e){function n(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var a={};return n.m=e,n.c=a,n.i=function(e){return e},n.d=function(e,a,t){n.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:t})},n.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(a,"a",a),a},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=6)}([function(e,n,a){"use strict";function t(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n.default=e,n}Object.defineProperty(n,"__esModule",{value:!0}),n.setInitialLegend=n.fetchLegend=n.showLayersNotVisibleForScale=n.reverseLayerOrder=n.toggleNodeVisible=n.toggleNodeExpanded=n.SET_INITIAL_LEGEND_GRAPHICSLAYER_DATA=n.SET_INITIAL_LEGEND_MAPIMAGELAYER_DATA=n.SHOW_LAYERS_NOT_VISIBLE_FOR_SCALE=n.REVERSE_LAYER_ORDER=n.SET_LEGEND_DOM_DATA=n.TOGGLE_LEGEND_NODE_EXPANDED=n.RECEIVE_LEGEND_DATA=n.REQUEST_LEGEND_DATA=n.RESET_LEGEND_IS_FETCHING=n.TOGGLE_LEGEND_NODE_VISIBLE=n.SET_CURRENT_SCALE=void 0;var r=a(3),i=t(r),l=n.SET_CURRENT_SCALE="map-legend/SET_CURRENT_SCALE",d=n.TOGGLE_LEGEND_NODE_VISIBLE="map-legend/TOGGLE_LEGEND_NODE_VISIBLE",o=n.RESET_LEGEND_IS_FETCHING="map-legend/RESET_LEGEND_IS_FETCHING",s=n.REQUEST_LEGEND_DATA="map-legend/REQUEST_LEGEND_DATA",c=n.RECEIVE_LEGEND_DATA="map-legend/RECEIVE_LEGEND_DATA",u=n.TOGGLE_LEGEND_NODE_EXPANDED="map-legend/TOGGLE_LEGEND_NODE_EXPANDED",p=n.SET_LEGEND_DOM_DATA="map-legend/SET_LEGEND_DOM_DATA",E=n.REVERSE_LAYER_ORDER="map-legend/REVERSE_LAYER_ORDER",f=n.SHOW_LAYERS_NOT_VISIBLE_FOR_SCALE="map-legend/SHOW_LAYERS_NOT_VISIBLE_FOR_SCALE",g=n.SET_INITIAL_LEGEND_MAPIMAGELAYER_DATA="map-legend/SET_INITIAL_LEGEND_MAPIMAGELAYER_DATA",m=n.SET_INITIAL_LEGEND_GRAPHICSLAYER_DATA="map-legend/SET_INITIAL_LEGEND_GRAPHICSLAYER_DATA",y=(n.toggleNodeExpanded=function(e,n){return{type:u,payload:{nodeId:e,mapId:n}}},n.toggleNodeVisible=function(e,n){return{type:d,payload:{nodeId:e,mapId:n}}},n.reverseLayerOrder=function(e){return{type:E,payload:{mapId:e}}},n.showLayersNotVisibleForScale=function(e,n){return{type:f,payload:{mapId:e,show:n}}},n.fetchLegend=function(e,n){return function(a){a({type:s,payload:{url:e,mapId:n}}),i.dojoRequire(["esri/request","esri/config"],function(t,r){return r.request.corsDetection=!1,t(e+"/legend",{query:{f:"json"},responseType:"json"}).then(function(t){a({type:c,payload:{layers:t.data.layers,url:e,mapId:n}})},function(e){console.error(e),a({type:o})})})}},function(e,n){var a=e._buildLegendDOMForLayer;e._buildLegendDOMForLayer=function(t,r){var i=a.call(e,t,r);return n(i,e),i}}),L=function(e,n,a){var t;return function(){var r=this,i=arguments,l=function(){t=null,a||e.apply(r,i)},d=a&&!t;clearTimeout(t),t=setTimeout(l,n),d&&e.apply(r,i)}},b=L(function(e,n,a){e({type:l,payload:{scale:n,mapId:a}})},250),_=function(e,n,a,t){i.dojoRequire(["esri/widgets/Legend"],function(r){y(new r({view:e,layerInfos:[{layer:a}]}),function(e,a){setTimeout(function(){e&&e.widget&&t({type:p,payload:{legendWidget:e.widget,mapId:n}}),a&&a.destroy&&a.destroy()},250)})})};n.setInitialLegend=function(e,n){return function(a){e.then(function(){b(a,e.scale,n),e.watch("scale",function(e){b(a,e,n)});var t=1;e.map.layers.forEach(function(r){r.__index=t,t++,r.then(function(t){t.loaded&&t.type&&["map-image"].indexOf(t.type.toLowerCase())>-1&&t.allSublayers&&t.legendEnabled&&a({type:g,payload:{view:e,mapId:n,layer:t}}),t.loaded&&t.type&&["csv","feature","graphics","scene","stream"].indexOf(t.type.toLowerCase())>-1&&(r.url||r.source)&&t.legendEnabled&&(a({type:m,payload:{view:e,mapId:n,layer:t}}),_(e,n,t,a))},function(e){console.error("Failed to load a layer for use with the legend control.",e)})})})}}},function(e,n,a){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function l(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var d=function(){function e(e,n){for(var a=0;a<n.length;a++){var t=n[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,a,t){return a&&e(n.prototype,a),t&&e(n,t),n}}(),o=a(4),s=t(o),c=a(5),u=a(0),p={clickLegendNode:{cursor:"pointer",marginRight:6,display:"inline-block"},inlineBlockDisplay:{display:"inline-block",marginTop:8,marginBottom:0},legendMap:{paddingTop:10,paddingRight:6,paddingBottom:10,paddingLeft:6,backgroundColor:"#ebebeb",fontWeight:"bold"},legendCheckbox:{cursor:"pointer",marginRight:8,color:"#EF5350"},legendCheckboxSelected:{cursor:"pointer",marginRight:8},legendCheckboxLabel:{fontWeight:400,cursor:"pointer"},textStyle:{display:"inline-block",verticalAlign:"bottom",fontWeight:500}},E=function(e){function n(){var e,a,t,l;r(this,n);for(var d=arguments.length,o=Array(d),c=0;c<d;c++)o[c]=arguments[c];return a=t=i(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(o))),t.initialise=function(){var e=t.props,n=e.legends,a=e.mapId,r=e.fetchLegend,i=n[a];i&&i.forEach(function(e){!e.url||e.isFetching||e.alreadyLoaded||r(e.url,a)})},t.renderSubNodeLegendData=function(e){var n={width:e.imageWidth+8,height:e.imageHeight,backgroundImage:"url(data:image/png;base64,"+e.image+")",backgroundRepeat:"no-repeat",display:"inline-block"},a={marginLeft:16,marginTop:6};return s.default.createElement("div",{key:e.id,style:a},s.default.createElement("div",{style:n}),s.default.createElement("label",{style:p.textStyle},e.label))},t.renderSubNodes=function(e){var n=t.props,a=n.mapId,r=n.scales,i=n.toggleNodeExpanded,l=n.toggleNodeVisible,d=r[a],o={marginLeft:8},c=e.expanded&&e.subLayerLegendData?e.subLayerLegendData.map(t.renderSubNodeLegendData):null;d&&e.subLayerScaleRestricted&&(0!==e.subLayerMinScale&&e.subLayerMinScale<d||0!==e.subLayerMaxScale&&e.subLayerMaxScale>d)&&(o.color="#dcdcdc");var u=e.subLayerLegendData?s.default.createElement("div",{onClick:function(){return i(e.id,a)},style:p.clickLegendNode},e.expanded?s.default.createElement("span",{className:"esri-icon-down"}):s.default.createElement("span",{className:"esri-icon-right"})):null,E=s.default.createElement("div",{style:p.inlineBlockDisplay},s.default.createElement("div",{style:p.inlineBlockDisplay},s.default.createElement("span",{style:e.visible?p.legendCheckboxSelected:p.legendCheckbox,onClick:function(){return l(e.id,a)},className:e.visible?"esri-icon-visible":"esri-icon-non-visible"}),s.default.createElement("label",{style:p.legendCheckboxLabel,onClick:function(){return l(e.id,a)}},e.subLayerName)));return s.default.createElement("div",{key:e.id,style:o},u,E,c)},t.renderNodes=function(e){if(!e.alreadyLoaded)return null;var n=t.props,a=n.mapId,r=n.scales,i=n.toggleNodeExpanded,l=n.toggleNodeVisible,d=r[a],o={marginLeft:4,marginTop:8},c={marginLeft:8};if(d&&e.scaleRestricted&&(0!==e.minScale&&e.minScale<d||0!==e.maxScale&&e.maxScale>d)){if(e.showLayersNotVisibleForScale===!1)return null;o.color="#dcdcdc"}var u=e.expanded&&(e.legendLayers||e.hasDomNode)?e.legendLayers?e.legendLayers.map(t.renderSubNodes):e.hasDomNode?s.default.createElement("div",{style:c,dangerouslySetInnerHTML:{__html:e.domNode}}):null:null,E=e.legendLayers||e.hasDomNode?s.default.createElement("div",{onClick:function(){return i(e.id,a)},style:p.clickLegendNode},e.expanded?s.default.createElement("span",{className:"esri-icon-down"}):s.default.createElement("span",{className:"esri-icon-right"})):null,f=s.default.createElement("div",{style:p.inlineBlockDisplay},s.default.createElement("span",{style:e.visible?p.legendCheckboxSelected:p.legendCheckbox,onClick:function(){return l(e.id,a)},className:e.visible?"esri-icon-visible":"esri-icon-non-visible"}),s.default.createElement("label",{style:p.legendCheckboxLabel,onClick:function(){return l(e.id,a)}},e.layerName));return s.default.createElement("div",{key:e.id,style:o},E,f,u)},l=a,i(t,l)}return l(n,e),d(n,[{key:"componentDidMount",value:function(){this.initialise()}},{key:"componentDidUpdate",value:function(e,n){this.initialise()}},{key:"render",value:function(){var e=this.props,n=e.legends,a=e.mapId,t=n[a];return t?s.default.createElement("div",{className:"arcgis-legend"},s.default.createElement("div",null,s.default.createElement("h5",{style:p.legendMap},a.split("-").join(" - "))),s.default.createElement("div",null,t.map(this.renderNodes))):null}}]),n}(s.default.Component),f=function(e){return{legends:e.mapLegendConfig.legends,scales:e.mapLegendConfig.scales}},g=function(e){return{fetchLegend:function(n,a){e((0,u.fetchLegend)(n,a))},toggleNodeExpanded:function(n,a){e((0,u.toggleNodeExpanded)(n,a))},toggleNodeVisible:function(n,a){e((0,u.toggleNodeVisible)(n,a))}}};E.propTypes={mapId:s.default.PropTypes.string.isRequired,view:s.default.PropTypes.object.isRequired},n.default=(0,c.connect)(f,g)(E)},function(e,n,a){"use strict";function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}Object.defineProperty(n,"__esModule",{value:!0});var r,i=a(0),l=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},d=function(){return l()+l()+"-"+l()+"-"+l()+"-"+l()+"-"+l()+l()+l()},o=function(e,n){return e.mapIndex-n.mapIndex},s=function(e,n){return n.mapIndex-e.mapIndex},c=function(e,n){n.forEach(function(n){if(n.alreadyLoaded===!0){var a=e.map.layers.find(function(e){return e.uid===n.uid});if(!a)return null;n.visible&&n.subLayersVisible&&a.sublayers&&a.sublayers&&(a.sublayers=a.sublayers.map(function(e){var a=n.subLayersVisible.filter(function(n){return e.id===n});return e.visible=a&&1===a.length,e})),a.visible!==n.visible&&(a.visible=n.visible)}})},u={isFetching:!1,legends:{},views:{},scales:{}},p=function(e,n){return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,t=arguments[1],r=n[t.type];return r?r(a,t.payload):a}};n.default=p(u,(r={},t(r,i.SET_CURRENT_SCALE,function(e,n){var a=Object.assign({},e.scales);return a[n.mapId]=n.scale,Object.assign({},e,{scales:a})}),t(r,i.RESET_LEGEND_IS_FETCHING,function(e,n){return Object.assign({},e,{isFetching:!1})}),t(r,i.REVERSE_LAYER_ORDER,function(e,n){var a=Object.assign({},e.legends),t=a[n.mapId],r=t.map(function(e,n){return e.reverseLayerOrder=!e.reverseLayerOrder,e});return a[n.mapId]=r.sort(r[0].reverseLayerOrder?s:o),Object.assign({},e,{legends:a})}),t(r,i.SHOW_LAYERS_NOT_VISIBLE_FOR_SCALE,function(e,n){var a=Object.assign({},e.legends),t=a[n.mapId],r=t.map(function(e,a){return e.showLayersNotVisibleForScale=n.show,e});return a[n.mapId]=r,Object.assign({},e,{legends:a})}),t(r,i.REQUEST_LEGEND_DATA,function(e,n){var a=Object.assign({},e.legends),t=a[n.mapId],r=t.map(function(e,a){return e.url===n.url&&(e.isFetching=!0),e});return a[n.mapId]=r,Object.assign({},e,{isFetching:!0,legends:a})}),t(r,i.RECEIVE_LEGEND_DATA,function(e,n){var a=Object.assign({},e.legends),t=a[n.mapId],r=t.map(function(e,a){return e.url===n.url&&(e.legendLayers=n.layers.map(function(n){var a=n.legend.map(function(e){return{label:e.label,image:e.imageData,imageHeight:e.height,imageWidth:e.width,id:d()}});return{subLayerId:n.layerId,subLayerName:n.layerName,subLayerMinScale:n.minScale,subLayerMaxScale:n.maxScale,subLayerScaleRestricted:0!==n.minScale||0!==n.maxScale,subLayerLegendData:a,visible:!e.subLayersVisible||e.subLayersVisible.indexOf(n.layerId)>-1,expanded:!0,id:d()}}),e.alreadyLoaded=!0,e.expanded=!0),e});return a[n.mapId]=r,Object.assign({},e,{isFetching:!1,legends:a})}),t(r,i.SET_INITIAL_LEGEND_MAPIMAGELAYER_DATA,function(e,n){var a=Object.assign({},e.views);a[n.mapId]=n.view;var t=n.layer,r=[];t.allSublayers.items.forEach(function(e){e.visible&&r.push(e.id)});var i=[{layerId:t.id,layerName:t.title||t.id,minScale:t.minScale,maxScale:t.maxScale,scaleRestricted:0!==t.minScale||0!==t.maxScale,visible:t.visible,subLayersVisible:r,url:t.url.replace(/\/+$/,""),legendLayers:null,hasDomNode:!1,alreadyLoaded:!1,isFetching:!1,expanded:!1,id:d(),uid:t.uid,mapIndex:t.__index,reverseLayerOrder:!1,showLayersNotVisibleForScale:!0}],l=Object.assign({},e.legends);return l[n.mapId]=l[n.mapId]&&l[n.mapId].length?l[n.mapId].concat(i):i,l[n.mapId].sort(o),Object.assign({},e,{legends:l,views:a})}),t(r,i.SET_INITIAL_LEGEND_GRAPHICSLAYER_DATA,function(e,n){var a=Object.assign({},e.views);a[n.mapId]=n.view;var t=n.layer,r=[{layerId:t.id,layerName:t.title||t.id,minScale:t.minScale,maxScale:t.maxScale,scaleRestricted:0!==t.minScale||0!==t.maxScale,visible:t.visible,legendLayers:null,hasDomNode:!1,alreadyLoaded:!1,isFetching:!1,expanded:!1,id:d(),uid:t.uid,mapIndex:t.__index,reverseLayerOrder:!1,showLayersNotVisibleForScale:!0}],i=Object.assign({},e.legends);return i[n.mapId]=i[n.mapId]&&i[n.mapId].length?i[n.mapId].concat(r):r,i[n.mapId].sort(o),Object.assign({},e,{legends:i,views:a})}),t(r,i.SET_LEGEND_DOM_DATA,function(e,n){var a=Object.assign({},e.legends);return a[n.mapId]=a[n.mapId].map(function(e,a){if(n.legendWidget&&n.legendWidget.children&&n.legendWidget.children.length>0){for(var t=null,r=0;r<n.legendWidget.children.length;r++){var i=n.legendWidget.children[r];if(i.id.split("_").pop()===e.uid){t=i;break}}e.hasDomNode===!1&&t&&t.children&&t.children.length>1&&(e.alreadyLoaded=!0,e.hasDomNode=!0,e.domNode=t.children[1].outerHTML,e.expanded=!0)}return e}),Object.assign({},e,{legends:a})}),t(r,i.TOGGLE_LEGEND_NODE_EXPANDED,function(e,n){var a=Object.assign({},e.legends),t=a[n.mapId],r=t.map(function(e,a){if(e.id===n.nodeId)e.expanded=!e.expanded;else if(e.legendLayers){var t=e.legendLayers.map(function(e){return e.id===n.nodeId&&(e.expanded=!e.expanded),e});e.legendLayers=t}return e});return a[n.mapId]=r,Object.assign({},e,{legends:a})}),t(r,i.TOGGLE_LEGEND_NODE_VISIBLE,function(e,n){var a=Object.assign({},e.legends),t=a[n.mapId],r=t.map(function(e,a){if(e.id===n.nodeId)e.visible=!e.visible;else if(e.legendLayers){var t=e.legendLayers.map(function(e){return e.id===n.nodeId&&(e.visible=!e.visible),e}),r=[];e.legendLayers.forEach(function(e){e.visible&&r.push(e.subLayerId)}),e.subLayersVisible=r,e.legendLayers=t}return e});return a[n.mapId]=r,c(e.views[n.mapId],t),Object.assign({},e,{legends:a})}),r))},function(e,n){e.exports=require("esri-loader")},function(e,n){e.exports=require("react")},function(e,n){e.exports=require("react-redux")},function(e,n,a){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.MapLegend=a(1).default,n.reducer=a(2).default,n.setInitialLegend=a(0).setInitialLegend,n.reverseLayerOrder=a(0).reverseLayerOrder,n.showLayersNotVisibleForScale=a(0).showLayersNotVisibleForScale}])});
//# sourceMappingURL=arcgis-react-redux-legend.js.map