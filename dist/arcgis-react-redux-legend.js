!function(e,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n(require("esri-loader"),require("react"),require("react-redux"));else if("function"==typeof define&&define.amd)define(["esri-loader","react","react-redux"],n);else{var t="object"==typeof exports?n(require("esri-loader"),require("react"),require("react-redux")):n(e["esri-loader"],e.react,e["react-redux"]);for(var a in t)("object"==typeof exports?exports:e)[a]=t[a]}}(this,function(e,n,t){return function(e){function n(a){if(t[a])return t[a].exports;var r=t[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MapLegend=t(2).default,n.reducer=t(3).default,n.setInitialLegend=t(1).setInitialLegend},function(e,n,t){"use strict";function a(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n}Object.defineProperty(n,"__esModule",{value:!0}),n.setInitialLegend=n.fetchLegend=n.toggleNodeVisible=n.toggleNodeExpanded=n.SET_LEGEND_DOM_DATA=n.TOGGLE_LEGEND_NODE_EXPANDED=n.SET_INITIAL_LEGEND_DATA=n.RECEIVE_LEGEND_DATA=n.REQUEST_LEGEND_DATA=n.RESET_LEGEND_IS_FETCHING=n.TOGGLE_LEGEND_NODE_VISIBLE=n.SET_CURRENT_SCALE=void 0;var r=t(4),i=a(r),l=n.SET_CURRENT_SCALE="map-legend/SET_CURRENT_SCALE",d=n.TOGGLE_LEGEND_NODE_VISIBLE="map-legend/TOGGLE_LEGEND_NODE_VISIBLE",o=n.RESET_LEGEND_IS_FETCHING="map-legend/RESET_LEGEND_IS_FETCHING",s=n.REQUEST_LEGEND_DATA="map-legend/REQUEST_LEGEND_DATA",u=n.RECEIVE_LEGEND_DATA="map-legend/RECEIVE_LEGEND_DATA",c=n.SET_INITIAL_LEGEND_DATA="map-legend/SET_INITIAL_LEGEND_DATA",f=n.TOGGLE_LEGEND_NODE_EXPANDED="map-legend/TOGGLE_LEGEND_NODE_EXPANDED",p=n.SET_LEGEND_DOM_DATA="map-legend/SET_LEGEND_DOM_DATA",g=(n.toggleNodeExpanded=function(e,n){return{type:f,payload:{nodeId:e,mapId:n}}},n.toggleNodeVisible=function(e,n){return{type:d,payload:{nodeId:e,mapId:n}}},n.fetchLegend=function(e,n){return function(t){t({type:s,payload:{url:e,mapId:n}}),i.dojoRequire(["esri/request","esri/config"],function(a,r){return r.request.corsDetection=!1,a(e+"/legend",{query:{f:"json"},responseType:"json"}).then(function(a){t({type:u,payload:{layers:a.data.layers,url:e,mapId:n}})},function(e){console.error(e),t({type:o})})})}},function(e,n){var t=e._buildLegendDOMForLayer;e._buildLegendDOMForLayer=function(a,r){var i=t.call(e,a,r);return n(i),i}});n.setInitialLegend=function(e,n){return function(t){i.dojoRequire(["esri/core/watchUtils","esri/widgets/Legend"],function(a,r){e.then(function(){e.map.layers.forEach(function(i){a.once(i,"loaded",function(a){var i=e.map.layers.items.map(function(e){return e.loaded||e.loadError}).reduce(function(e,n){return e&&n});i&&!function(){t({type:c,payload:{view:e,mapId:n}});var a=e.map.layers.filter(function(e){return e.type&&("feature"===e.type.toLowerCase()||"graphics"===e.type.toLowerCase())&&!e.loadError&&(e.url||e.source)}).map(function(e,n){return{layer:e}});a&&a.length>0&&!function(){var i=new r({view:e,layerInfos:a}),l=0;g(i,function(e){l++,l===a.length&&setTimeout(function(){t({type:p,payload:{legendWidget:e.widget,mapId:n}}),i.destroy(),i=null},400)})}()}()})}),e.watch("scale",function(e){t({type:l,payload:{scale:e,mapId:n}})})})})}}},function(e,n,t){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function l(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var d=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),o=t(5),s=a(o),u=t(6),c=t(1),f={clickLegendNode:{cursor:"pointer",marginRight:6,display:"inline-block"},inlineBlockDisplay:{display:"inline-block"},legendMap:{paddingTop:10,paddingRight:6,paddingBottom:10,paddingLeft:6,backgroundColor:"#ebebeb",fontWeight:"bold"},legendCheckbox:{position:"relative",display:"inline-block",marginTop:10,marginRight:6,marginBottom:10,marginLeft:0},legendCheckboxLabel:{minHeight:20,marginBottom:0,fontWeight:400,cursor:"pointer"},textStyle:{display:"inline-block",verticalAlign:"bottom",fontWeight:500}},p=function(e){function n(){var e,t,a,l;r(this,n);for(var d=arguments.length,o=Array(d),u=0;u<d;u++)o[u]=arguments[u];return t=a=i(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(o))),a.initialise=function(){var e=a.props,n=e.legends,t=e.mapId,r=e.fetchLegend,i=n[t];i&&i.items.forEach(function(e){e.url&&e.alreadyLoaded===!1&&r(e.url,t)})},a.renderSubNodeLegendData=function(e){var n={width:e.imageWidth+8,height:e.imageHeight,backgroundImage:"url(data:image/png;base64,"+e.image+")",backgroundRepeat:"no-repeat",display:"inline-block"},t={marginLeft:16};return s.default.createElement("div",{key:e.id,style:t},s.default.createElement("div",{style:n}),s.default.createElement("label",{style:f.textStyle},e.label))},a.renderSubNodes=function(e){var n=a.props,t=n.mapId,r=n.scales,i=n.toggleNodeExpanded,l=n.toggleNodeVisible,d=r[t],o={marginLeft:8,marginTop:8},u=e.expanded&&e.subLayerLegendData?e.subLayerLegendData.map(a.renderSubNodeLegendData):"";d&&e.subLayerScaleRestricted&&(0!==e.subLayerMinScale&&e.subLayerMinScale<d||0!==e.subLayerMaxScale&&e.subLayerMaxScale>d)&&(o.color="#dcdcdc");var c=e.subLayerLegendData?s.default.createElement("div",{onClick:function(){return i(e.id,t)},style:f.clickLegendNode},s.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 32 32"},e.expanded?s.default.createElement("path",{d:"M28 9v5L16 26 4 14V9l12 12L28 9z"}):s.default.createElement("path",{d:"M7 4h5l12 12-12 12H7l12-12L7 4z"}))):"",p=s.default.createElement("div",{style:f.inlineBlockDisplay},s.default.createElement("label",{style:f.legendCheckboxLabel},s.default.createElement("input",{type:"checkbox",style:f.legendCheckbox,onChange:function(){return l(e.id,t)},checked:e.visible}),e.subLayerName));return s.default.createElement("div",{key:e.id,style:o},c,p,u)},a.renderNodes=function(e){if(!e.alreadyLoaded)return"";var n=a.props,t=n.mapId,r=n.scales,i=n.toggleNodeExpanded,l=n.toggleNodeVisible,d=r[t],o={marginLeft:4},u={marginLeft:8,marginTop:8},c=e.expanded&&(e.legendLayers||e.hasDomNode)?e.legendLayers?e.legendLayers.map(a.renderSubNodes):e.hasDomNode?s.default.createElement("div",{style:u,dangerouslySetInnerHTML:{__html:e.domNode}}):"":"";d&&e.scaleRestricted&&(0!==e.minScale&&e.minScale<d||0!==e.maxScale&&e.maxScale>d)&&(o.color="#dcdcdc");var p=e.legendLayers||e.hasDomNode?s.default.createElement("div",{onClick:function(){return i(e.id,t)},style:f.clickLegendNode},s.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 32 32"},e.expanded?s.default.createElement("path",{d:"M28 9v5L16 26 4 14V9l12 12L28 9z"}):s.default.createElement("path",{d:"M7 4h5l12 12-12 12H7l12-12L7 4z"}))):"",g=s.default.createElement("div",{style:f.inlineBlockDisplay},s.default.createElement("label",{style:f.legendCheckboxLabel},s.default.createElement("input",{type:"checkbox",style:f.legendCheckbox,onChange:function(){return l(e.id,t)},checked:e.visible}),e.layerName));return s.default.createElement("div",{key:e.id,style:o},p,g,c)},l=t,i(a,l)}return l(n,e),d(n,[{key:"componentDidMount",value:function(){this.initialise()}},{key:"componentDidUpdate",value:function(e,n){this.initialise()}},{key:"render",value:function(){var e=this.props,n=e.legends,t=e.mapId,a=n[t];return a?s.default.createElement("div",{id:"legend"},s.default.createElement("div",null,s.default.createElement("h5",{style:f.legendMap},t.split("-").join(" - "))),s.default.createElement("div",null,a.items.map(this.renderNodes))):null}}]),n}(s.default.Component),g=function(e){return{legends:e.mapLegendConfig.legends,scales:e.mapLegendConfig.scales}},E=function(e){return{fetchLegend:function(n,t){e((0,c.fetchLegend)(n,t))},toggleNodeExpanded:function(n,t){e((0,c.toggleNodeExpanded)(n,t))},toggleNodeVisible:function(n,t){e((0,c.toggleNodeVisible)(n,t))}}};n.default=(0,u.connect)(g,E)(p)},function(e,n,t){"use strict";function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}Object.defineProperty(n,"__esModule",{value:!0});var r,i=t(1),l=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},d=function(){return l()+l()+"-"+l()+"-"+l()+"-"+l()+"-"+l()+l()+l()},o=function(e,n){n.items.forEach(function(n){if(n.alreadyLoaded===!0){var t=e.map.layers.filter(function(e){return e.title===n.layerName||e.id===n.layerName});if(t&&t.items&&1!==t.items.length)return null;var a=t.items[0];n.visible&&n.subLayersVisible&&a.sublayers&&a.sublayers&&(a.sublayers=a.sublayers.map(function(e){var t=n.subLayersVisible.filter(function(n){return e.id===n});return e.visible=t&&1===t.length,e})),a.visible!==n.visible&&(a.visible=n.visible)}})},s={isFetching:!1,legends:{},views:{},scales:{}},u=function(e,n){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,a=arguments[1],r=n[a.type];return r?r(t,a.payload):t}};n.default=u(s,(r={},a(r,i.SET_CURRENT_SCALE,function(e,n){var t=Object.assign({},e.scales);return t[n.mapId]=n.scale,Object.assign({},e,{scales:t})}),a(r,i.RESET_LEGEND_IS_FETCHING,function(e,n){return Object.assign({},e,{isFetching:!1})}),a(r,i.REQUEST_LEGEND_DATA,function(e,n){return Object.assign({},e,{isFetching:!0})}),a(r,i.RECEIVE_LEGEND_DATA,function(e,n){var t=Object.assign({},e.legends),a=t[n.mapId],r=a.items.map(function(e,t){return e.url===n.url&&(e.legendLayers=n.layers.map(function(n){var t=n.legend.map(function(e){return{label:e.label,image:e.imageData,imageHeight:e.height,imageWidth:e.width,id:d()}});return{subLayerId:n.layerId,subLayerName:n.layerName,subLayerMinScale:n.minScale,subLayerMaxScale:n.maxScale,subLayerScaleRestricted:0!==n.minScale||0!==n.maxScale,subLayerLegendData:t,visible:!e.subLayersVisible||e.subLayersVisible.indexOf(n.layerId)>-1,expanded:!0,id:d()}})),e.alreadyLoaded=!0,e.expanded=!0,e});return a.items=r,t[n.mapId]=a,Object.assign({},e,{isFetching:!1,legends:t})}),a(r,i.SET_INITIAL_LEGEND_DATA,function(e,n){var t=Object.assign({},e.views);t[n.mapId]=n.view;var a=n.view.map.layers.filter(function(e){return!e.loadError&&e.allSublayers}).map(function(e,n){var t=[];return e.allSublayers.items.forEach(function(e){e.visible&&t.push(e.id)}),{layerId:n,layerName:e.title||e.id,minScale:e.minScale,maxScale:e.maxScale,scaleRestricted:0!==e.minScale||0!==e.maxScale,visible:e.visible,subLayersVisible:t,url:e.url.replace(/\/+$/,""),legendLayers:null,hasDomNode:!1,alreadyLoaded:!1,expanded:!1,id:d(),uid:e.uid}}),r=n.view.map.layers.filter(function(e){return!e.loadError&&e.type&&("feature"===e.type.toLowerCase()||"graphics"===e.type.toLowerCase())}).map(function(e,n){return{layerId:n,layerName:e.title||e.id,minScale:e.minScale,maxScale:e.maxScale,scaleRestricted:0!==e.minScale||0!==e.maxScale,visible:e.visible,legendLayers:null,hasDomNode:!1,alreadyLoaded:!1,expanded:!1,id:d(),uid:e.uid}}),i=Object.assign({},e.legends);return i[n.mapId]=a.concat(r),Object.assign({},e,{legends:i,views:t})}),a(r,i.SET_LEGEND_DOM_DATA,function(e,n){var t=Object.assign({},e.legends);return t[n.mapId].items=t[n.mapId].items.map(function(e,t){if(n.legendWidget&&n.legendWidget.children&&n.legendWidget.children.length>0){for(var a=null,r=0;r<n.legendWidget.children.length;r++){var i=n.legendWidget.children[r];if(i.id.split("_").pop()===e.uid){a=i;break}}e.hasDomNode===!1&&a&&a.children&&a.children.length>1&&(e.alreadyLoaded=!0,e.hasDomNode=!0,e.domNode=a.children[1].outerHTML,e.expanded=!0)}return e}),Object.assign({},e,{legends:t})}),a(r,i.TOGGLE_LEGEND_NODE_EXPANDED,function(e,n){var t=Object.assign({},e.legends),a=t[n.mapId],r=a.items.map(function(e,t){if(e.id===n.nodeId)e.expanded=!e.expanded;else if(e.legendLayers){var a=e.legendLayers.map(function(e){return e.id===n.nodeId&&(e.expanded=!e.expanded),e});e.legendLayers=a}return e});return a.items=r,t[n.mapId]=a,Object.assign({},e,{legends:t})}),a(r,i.TOGGLE_LEGEND_NODE_VISIBLE,function(e,n){var t=Object.assign({},e.legends),a=t[n.mapId],r=a.items.map(function(e,t){return e.id===n.nodeId?e.visible=!e.visible:e.legendLayers&&!function(){var t=e.legendLayers.map(function(e){return e.id===n.nodeId&&(e.visible=!e.visible),e}),a=[];e.legendLayers.forEach(function(e){e.visible&&a.push(e.subLayerId)}),e.subLayersVisible=a,e.legendLayers=t}(),e});return a.items=r,t[n.mapId]=a,o(e.views[n.mapId],a),Object.assign({},e,{legends:t})}),r))},function(e,n){e.exports=require("esri-loader")},function(e,n){e.exports=require("react")},function(e,n){e.exports=require("react-redux")}])});
//# sourceMappingURL=arcgis-react-redux-legend.js.map