!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("babel-runtime/core-js/object/assign"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/helpers/defineProperty"),require("babel-runtime/helpers/inherits"),require("babel-runtime/helpers/possibleConstructorReturn"),require("esri-loader"),require("react"),require("react-redux"));else if("function"==typeof define&&define.amd)define(["babel-runtime/core-js/object/assign","babel-runtime/core-js/object/get-prototype-of","babel-runtime/helpers/classCallCheck","babel-runtime/helpers/createClass","babel-runtime/helpers/defineProperty","babel-runtime/helpers/inherits","babel-runtime/helpers/possibleConstructorReturn","esri-loader","react","react-redux"],t);else{var r="object"==typeof exports?t(require("babel-runtime/core-js/object/assign"),require("babel-runtime/core-js/object/get-prototype-of"),require("babel-runtime/helpers/classCallCheck"),require("babel-runtime/helpers/createClass"),require("babel-runtime/helpers/defineProperty"),require("babel-runtime/helpers/inherits"),require("babel-runtime/helpers/possibleConstructorReturn"),require("esri-loader"),require("react"),require("react-redux")):t(e["babel-runtime/core-js/object/assign"],e["babel-runtime/core-js/object/get-prototype-of"],e["babel-runtime/helpers/classCallCheck"],e["babel-runtime/helpers/createClass"],e["babel-runtime/helpers/defineProperty"],e["babel-runtime/helpers/inherits"],e["babel-runtime/helpers/possibleConstructorReturn"],e["esri-loader"],e.react,e["react-redux"]);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,function(e,t,r,n,a,i,l,o,d,s){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toggleNodeVisible=t.toggleNodeExpanded=t.setInitialLegend=t.fetchLegend=t.setCurrentScale=t.TOGGLE_LEGEND_NODE_VISIBLE=t.TOGGLE_LEGEND_NODE_EXPANDED=t.SET_INITIAL_LEGEND_DATA=t.RECEIVE_LEGEND_DATA=t.REQUEST_LEGEND_DATA=t.RESET_LEGEND_IS_FETCHING=t.SET_CURRENT_SCALE=t.reducer=t.MapLegend=void 0,r(7),t.MapLegend=r(2).default,t.reducer=r(3).default,t.SET_CURRENT_SCALE=r(1).SET_CURRENT_SCALE,t.RESET_LEGEND_IS_FETCHING=r(1).RESET_LEGEND_IS_FETCHING,t.REQUEST_LEGEND_DATA=r(1).REQUEST_LEGEND_DATA,t.RECEIVE_LEGEND_DATA=r(1).RECEIVE_LEGEND_DATA,t.SET_INITIAL_LEGEND_DATA=r(1).SET_INITIAL_LEGEND_DATA,t.TOGGLE_LEGEND_NODE_EXPANDED=r(1).TOGGLE_LEGEND_NODE_EXPANDED,t.TOGGLE_LEGEND_NODE_VISIBLE=r(1).TOGGLE_LEGEND_NODE_VISIBLE,t.setCurrentScale=r(1).setCurrentScale,t.fetchLegend=r(1).fetchLegend,t.setInitialLegend=r(1).setInitialLegend,t.toggleNodeExpanded=r(1).toggleNodeExpanded,t.toggleNodeVisible=r(1).toggleNodeVisible},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.setInitialLegend=t.fetchLegend=t.toggleNodeVisible=t.toggleNodeExpanded=t.SET_LEGEND_DOM_DATA=t.TOGGLE_LEGEND_NODE_EXPANDED=t.SET_INITIAL_LEGEND_DATA=t.RECEIVE_LEGEND_DATA=t.REQUEST_LEGEND_DATA=t.RESET_LEGEND_IS_FETCHING=t.TOGGLE_LEGEND_NODE_VISIBLE=t.SET_CURRENT_SCALE=void 0;var a=r(15),i=n(a),l=t.SET_CURRENT_SCALE="map-legend/SET_CURRENT_SCALE",o=t.TOGGLE_LEGEND_NODE_VISIBLE="map-legend/TOGGLE_LEGEND_NODE_VISIBLE",d=t.RESET_LEGEND_IS_FETCHING="map-legend/RESET_LEGEND_IS_FETCHING",s=t.REQUEST_LEGEND_DATA="map-legend/REQUEST_LEGEND_DATA",u=t.RECEIVE_LEGEND_DATA="map-legend/RECEIVE_LEGEND_DATA",c=t.SET_INITIAL_LEGEND_DATA="map-legend/SET_INITIAL_LEGEND_DATA",f=t.TOGGLE_LEGEND_NODE_EXPANDED="map-legend/TOGGLE_LEGEND_NODE_EXPANDED",p=t.SET_LEGEND_DOM_DATA="map-legend/SET_LEGEND_DOM_DATA",E=(t.toggleNodeExpanded=function(e,t){return{type:f,payload:{nodeId:e,mapId:t}}},t.toggleNodeVisible=function(e,t){return{type:o,payload:{nodeId:e,mapId:t}}},t.fetchLegend=function(e,t){return function(r){r({type:s,payload:{url:e,mapId:t}}),i.dojoRequire(["esri/request","esri/config"],function(n,a){return a.request.corsDetection=!1,n(e+"/legend",{query:{f:"json"},responseType:"json"}).then(function(n){r({type:u,payload:{layers:n.data.layers,url:e,mapId:t}})},function(e){console.error(e),r({type:d})})})}},function(e,t){var r=e._buildLegendDOMForLayer;e._buildLegendDOMForLayer=function(n,a){var i=r.call(e,n,a);return t(i),i}});t.setInitialLegend=function(e,t){return function(r){i.dojoRequire(["esri/core/watchUtils","esri/widgets/Legend"],function(n,a){e.then(function(){e.map.layers.forEach(function(i){n.once(i,"loaded",function(n){var i=e.map.layers.items.map(function(e){return e.loaded||e.loadError}).reduce(function(e,t){return e&&t});i&&!function(){r({type:c,payload:{view:e,mapId:t}});var n=e.map.layers.filter(function(e){return e.type&&("feature"===e.type.toLowerCase()||"graphics"===e.type.toLowerCase())&&!e.loadError}).map(function(e,t){return{layer:e}});n&&n.length>0&&!function(){var i=new a({view:e,layerInfos:n}),l=0;E(i,function(e){l++,l===n.length&&setTimeout(function(){r({type:p,payload:{legendWidget:e.widget,mapId:t}})},1e3)})}()}()})}),e.watch("scale",function(e){r({type:l,payload:{scale:e,mapId:t}})})})})}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(9),i=n(a),l=r(10),o=n(l),d=r(11),s=n(d),u=r(14),c=n(u),f=r(13),p=n(f),E=r(16),m=n(E),g=r(17),b=r(1),h=function(e){function t(){var e,r,n,a;(0,o.default)(this,t);for(var l=arguments.length,d=Array(l),s=0;s<l;s++)d[s]=arguments[s];return r=n=(0,c.default)(this,(e=t.__proto__||(0,i.default)(t)).call.apply(e,[this].concat(d))),n.initialise=function(){var e=n.props,t=e.legends,r=e.mapId,a=e.fetchLegend,i=t[r];i&&i.items.forEach(function(e){e.url&&e.alreadyLoaded===!1&&a(e.url,r)})},n.renderSubNodeLegendData=function(e){var t={width:e.imageWidth+8,height:e.imageHeight,backgroundImage:"url(data:image/png;base64,"+e.image+")",backgroundRepeat:"no-repeat",display:"inline-block"},r={display:"inline-block",verticalAlign:"bottom",fontWeight:500},n={marginLeft:16};return m.default.createElement("div",{key:e.id,style:n},m.default.createElement("div",{style:t}),m.default.createElement("label",{style:r},e.label))},n.renderSubNodes=function(e){var t=n.props,r=t.mapId,a=t.scales,i=t.toggleNodeExpanded,l=t.toggleNodeVisible,o=a[r],d={marginLeft:8,marginTop:8},s=e.expanded&&e.subLayerLegendData?e.subLayerLegendData.map(n.renderSubNodeLegendData):"";o&&e.subLayerScaleRestricted&&(0!==e.subLayerMinScale&&e.subLayerMinScale<o||0!==e.subLayerMaxScale&&e.subLayerMaxScale>o)&&(d.color="#dcdcdc");var u=e.subLayerLegendData?m.default.createElement("div",{onClick:function(){return i(e.id,r)},className:"click-legend-node"},m.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 32 32",className:"svg-icon"},e.expanded?m.default.createElement("path",{d:"M28 9v5L16 26 4 14V9l12 12L28 9z"}):m.default.createElement("path",{d:"M7 4h5l12 12-12 12H7l12-12L7 4z"}))):"",c=m.default.createElement("div",{className:"inline-block-display"},m.default.createElement("label",{className:"legend-checkbox-label"},m.default.createElement("input",{type:"checkbox",className:"legend-checkbox",onChange:function(){return l(e.id,r)},checked:e.visible}),e.subLayerName));return m.default.createElement("div",{key:e.id,style:d},u,c,s)},n.renderNodes=function(e){if(!e.alreadyLoaded)return"";var t=n.props,r=t.mapId,a=t.scales,i=t.toggleNodeExpanded,l=t.toggleNodeVisible,o=a[r],d={marginLeft:4},s={marginLeft:8,marginTop:8},u=e.expanded&&(e.legendLayers||e.hasDomNode)?e.legendLayers?e.legendLayers.map(n.renderSubNodes):e.hasDomNode?m.default.createElement("div",{style:s,dangerouslySetInnerHTML:{__html:e.domNode}}):"":"";o&&e.scaleRestricted&&(0!==e.minScale&&e.minScale<o||0!==e.maxScale&&e.maxScale>o)&&(d.color="#dcdcdc");var c=e.legendLayers||e.hasDomNode?m.default.createElement("div",{onClick:function(){return i(e.id,r)},className:"click-legend-node"},m.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 32 32",className:"svg-icon"},e.expanded?m.default.createElement("path",{d:"M28 9v5L16 26 4 14V9l12 12L28 9z"}):m.default.createElement("path",{d:"M7 4h5l12 12-12 12H7l12-12L7 4z"}))):"",f=m.default.createElement("div",{className:"inline-block-display"},m.default.createElement("label",{className:"legend-checkbox-label"},m.default.createElement("input",{type:"checkbox",className:"legend-checkbox",onChange:function(){return l(e.id,r)},checked:e.visible}),e.layerName));return m.default.createElement("div",{key:e.id,style:d},c,f,u)},a=r,(0,c.default)(n,a)}return(0,p.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){this.initialise()}},{key:"componentDidUpdate",value:function(e,t){this.initialise()}},{key:"render",value:function(){var e=this.props,t=e.legends,r=e.mapId,n=t[r];return n?m.default.createElement("div",{id:"legend"},m.default.createElement("div",null,m.default.createElement("h5",{className:"legend-map"},r.replace("-"," - "))),m.default.createElement("div",null,n.items.map(this.renderNodes))):null}}]),t}(m.default.Component),L=function(e){return{legends:e.mapLegendConfig.legends,scales:e.mapLegendConfig.scales}},y=function(e){return{fetchLegend:function(t,r){e((0,b.fetchLegend)(t,r))},toggleNodeExpanded:function(t,r){e((0,b.toggleNodeExpanded)(t,r))},toggleNodeVisible:function(t,r){e((0,b.toggleNodeVisible)(t,r))}}};t.default=(0,g.connect)(L,y)(h)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a,i=r(12),l=n(i),o=r(8),d=n(o),s=r(1),u=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},c=function(){return u()+u()+"-"+u()+"-"+u()+"-"+u()+"-"+u()+u()+u()},f=function(e,t){t.items.forEach(function(t){if(t.alreadyLoaded===!0){var r=e.map.layers.filter(function(e){return e.title===t.layerName||e.id===t.layerName});if(r&&r.items&&1!==r.items.length)return null;var n=r.items[0];t.visible&&t.subLayersVisible&&n.sublayers&&n.sublayers&&(n.sublayers=n.sublayers.map(function(e){var r=t.subLayersVisible.filter(function(t){return e.id===t});return e.visible=r&&1===r.length,e})),n.visible!==t.visible&&(n.visible=t.visible)}})},p={isFetching:!1,legends:{},views:{},scales:{}},E=function(e,t){return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,n=arguments[1],a=t[n.type];return a?a(r,n.payload):r}};t.default=E(p,(a={},(0,l.default)(a,s.SET_CURRENT_SCALE,function(e,t){var r=(0,d.default)({},e.scales);return r[t.mapId]=t.scale,(0,d.default)({},e,{scales:r})}),(0,l.default)(a,s.RESET_LEGEND_IS_FETCHING,function(e,t){return(0,d.default)({},e,{isFetching:!1})}),(0,l.default)(a,s.REQUEST_LEGEND_DATA,function(e,t){return(0,d.default)({},e,{isFetching:!0})}),(0,l.default)(a,s.RECEIVE_LEGEND_DATA,function(e,t){var r=(0,d.default)({},e.legends),n=r[t.mapId],a=n.items.map(function(e,r){return e.url===t.url&&(e.legendLayers=t.layers.map(function(t){var r=t.legend.map(function(e){return{label:e.label,image:e.imageData,imageHeight:e.height,imageWidth:e.width,id:c()}});return{subLayerId:t.layerId,subLayerName:t.layerName,subLayerMinScale:t.minScale,subLayerMaxScale:t.maxScale,subLayerScaleRestricted:0!==t.minScale||0!==t.maxScale,subLayerLegendData:r,visible:!e.subLayersVisible||e.subLayersVisible.indexOf(t.layerId)>-1,expanded:!0,id:c()}})),e.alreadyLoaded=!0,e.expanded=!0,e});return n.items=a,r[t.mapId]=n,(0,d.default)({},e,{isFetching:!1,legends:r})}),(0,l.default)(a,s.SET_INITIAL_LEGEND_DATA,function(e,t){var r=(0,d.default)({},e.views);r[t.mapId]=t.view;var n=t.view.map.layers.filter(function(e){return!e.loadError&&e.allSublayers}).map(function(e,t){var r=[];return e.allSublayers.items.forEach(function(e){e.visible&&r.push(e.id)}),{layerId:t,layerName:e.title||e.id,minScale:e.minScale,maxScale:e.maxScale,scaleRestricted:0!==e.minScale||0!==e.maxScale,visible:e.visible,subLayersVisible:r,url:e.url.replace(/\/+$/,""),legendLayers:null,hasDomNode:!1,alreadyLoaded:!1,expanded:!1,id:c(),uid:e.uid}}),a=t.view.map.layers.filter(function(e){return!e.loadError&&e.type&&("feature"===e.type.toLowerCase()||"graphics"===e.type.toLowerCase())}).map(function(e,t){return{layerId:t,layerName:e.title||e.id,minScale:e.minScale,maxScale:e.maxScale,scaleRestricted:0!==e.minScale||0!==e.maxScale,visible:e.visible,legendLayers:null,hasDomNode:!1,alreadyLoaded:!1,expanded:!1,id:c(),uid:e.uid}}),i=(0,d.default)({},e.legends);return i[t.mapId]=n.concat(a),(0,d.default)({},e,{legends:i,views:r})}),(0,l.default)(a,s.SET_LEGEND_DOM_DATA,function(e,t){var r=(0,d.default)({},e.legends);return r[t.mapId].items=r[t.mapId].items.map(function(e,r){if(t.legendWidget&&t.legendWidget.children&&t.legendWidget.children.length>0){for(var n=null,a=0;a<t.legendWidget.children.length;a++){var i=t.legendWidget.children[a];if(i.id.split("_").pop()===e.uid){n=i;break}}e.hasDomNode===!1&&n&&n.children&&n.children.length>1&&(e.alreadyLoaded=!0,e.hasDomNode=!0,e.domNode=n.children[1].outerHTML,e.expanded=!0)}return e}),(0,d.default)({},e,{legends:r})}),(0,l.default)(a,s.TOGGLE_LEGEND_NODE_EXPANDED,function(e,t){var r=(0,d.default)({},e.legends),n=r[t.mapId],a=n.items.map(function(e,r){if(e.id===t.nodeId)e.expanded=!e.expanded;else if(e.legendLayers){var n=e.legendLayers.map(function(e){return e.id===t.nodeId&&(e.expanded=!e.expanded),e});e.legendLayers=n}return e});return n.items=a,r[t.mapId]=n,(0,d.default)({},e,{legends:r})}),(0,l.default)(a,s.TOGGLE_LEGEND_NODE_VISIBLE,function(e,t){var r=(0,d.default)({},e.legends),n=r[t.mapId],a=n.items.map(function(e,r){return e.id===t.nodeId?e.visible=!e.visible:e.legendLayers&&!function(){var r=e.legendLayers.map(function(e){return e.id===t.nodeId&&(e.visible=!e.visible),e}),n=[];e.legendLayers.forEach(function(e){e.visible&&n.push(e.subLayerId)}),e.subLayersVisible=n,e.legendLayers=r}(),e});return n.items=a,r[t.mapId]=n,f(e.views[t.mapId],n),(0,d.default)({},e,{legends:r})}),a))},function(e,t,r){t=e.exports=r(5)(),t.push([e.id,".click-legend-node{cursor:pointer;margin-right:6px}.click-legend-node,.inline-block-display{display:inline-block}.legend-map{padding:10px 6px;background-color:#ebebeb;font-weight:700}.legend-checkbox{position:relative;display:inline-block;margin:10px 6px 10px 0!important}.legend-checkbox-label{min-height:20px;margin-bottom:0;font-weight:400;cursor:pointer}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var r=this[t];r[2]?e.push("@media "+r[2]+"{"+r[1]+"}"):e.push(r[1])}return e.join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},a=0;a<this.length;a++){var i=this[a][0];"number"==typeof i&&(n[i]=!0)}for(a=0;a<t.length;a++){var l=t[a];"number"==typeof l[0]&&n[l[0]]||(r&&!l[2]?l[2]=r:r&&(l[2]="("+l[2]+") and ("+r+")"),e.push(l))}},e}},function(e,t,r){function n(e,t){for(var r=0;r<e.length;r++){var n=e[r],a=p[n.id];if(a){a.refs++;for(var i=0;i<a.parts.length;i++)a.parts[i](n.parts[i]);for(;i<n.parts.length;i++)a.parts.push(s(n.parts[i],t))}else{for(var l=[],i=0;i<n.parts.length;i++)l.push(s(n.parts[i],t));p[n.id]={id:n.id,refs:1,parts:l}}}}function a(e){for(var t=[],r={},n=0;n<e.length;n++){var a=e[n],i=a[0],l=a[1],o=a[2],d=a[3],s={css:l,media:o,sourceMap:d};r[i]?r[i].parts.push(s):t.push(r[i]={id:i,parts:[s]})}return t}function i(e,t){var r=g(),n=L[L.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),L.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(t)}}function l(e){e.parentNode.removeChild(e);var t=L.indexOf(e);t>=0&&L.splice(t,1)}function o(e){var t=document.createElement("style");return t.type="text/css",i(e,t),t}function d(e){var t=document.createElement("link");return t.rel="stylesheet",i(e,t),t}function s(e,t){var r,n,a;if(t.singleton){var i=h++;r=b||(b=o(t)),n=u.bind(null,r,i,!1),a=u.bind(null,r,i,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=d(t),n=f.bind(null,r),a=function(){l(r),r.href&&URL.revokeObjectURL(r.href)}):(r=o(t),n=c.bind(null,r),a=function(){l(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else a()}}function u(e,t,r,n){var a=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=y(t,a);else{var i=document.createTextNode(a),l=e.childNodes;l[t]&&e.removeChild(l[t]),l.length?e.insertBefore(i,l[t]):e.appendChild(i)}}function c(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function f(e,t){var r=t.css,n=t.sourceMap;n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var a=new Blob([r],{type:"text/css"}),i=e.href;e.href=URL.createObjectURL(a),i&&URL.revokeObjectURL(i)}var p={},E=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},m=E(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),g=E(function(){return document.head||document.getElementsByTagName("head")[0]}),b=null,h=0,L=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=m()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var r=a(e);return n(r,t),function(e){for(var i=[],l=0;l<r.length;l++){var o=r[l],d=p[o.id];d.refs--,i.push(d)}if(e){var s=a(e);n(s,t)}for(var l=0;l<i.length;l++){var d=i[l];if(0===d.refs){for(var u=0;u<d.parts.length;u++)d.parts[u]();delete p[d.id]}}}};var y=function(){var e=[];return function(t,r){return e[t]=r,e.filter(Boolean).join("\n")}}()},function(e,t,r){var n=r(4);"string"==typeof n&&(n=[[e.id,n,""]]),r(6)(n,{}),n.locals&&(e.exports=n.locals)},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("esri-loader")},function(e,t){e.exports=require("react")},function(e,t){e.exports=require("react-redux")}])});